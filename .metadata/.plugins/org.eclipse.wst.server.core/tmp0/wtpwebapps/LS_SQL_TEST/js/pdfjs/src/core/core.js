"use strict";var Page=function(){function n(e,t,n,r,i,s){this.pdfManager=e;this.pageIndex=n;this.pageDict=r;this.xref=t;this.ref=i;this.fontCache=s;this.idCounters={obj:0};this.resourcesPromise=null}var t=[0,0,612,792];n.prototype={getPageProp:function(t){return this.pageDict.get(t)},getInheritedPageProp:function(t){var n=this.pageDict;var r=n.get(t);while(r===undefined){n=n.get("Parent");if(!n){break}r=n.get(t)}return r},get content(){return this.getPageProp("Contents")},get resources(){var e=this.getInheritedPageProp("Resources");if(e===undefined){e=new Dict}return shadow(this,"resources",e)},get mediaBox(){var e=this.getInheritedPageProp("MediaBox");if(!isArray(e)||e.length!==4){e=t}return shadow(this,"mediaBox",e)},get view(){var e=this.mediaBox;var t=this.getInheritedPageProp("CropBox");if(!isArray(t)||t.length!==4){return shadow(this,"view",e)}t=Util.intersect(t,e);if(!t){return shadow(this,"view",e)}return shadow(this,"view",t)},get annotationRefs(){return shadow(this,"annotationRefs",this.getInheritedPageProp("Annots"))},get rotate(){var e=this.getInheritedPageProp("Rotate")||0;if(e%90!==0){e=0}else if(e>=360){e=e%360}else if(e<0){e=(e%360+360)%360}return shadow(this,"rotate",e)},getContentStream:function(){var t=this.content;var n;if(isArray(t)){var r=this.xref;var i,s=t.length;var o=[];for(i=0;i<s;++i){o.push(r.fetchIfRef(t[i]))}n=new StreamsSequenceStream(o)}else if(isStream(t)){n=t}else{n=new NullStream}return n},loadResources:function(e){if(!this.resourcesPromise){this.resourcesPromise=this.pdfManager.ensure(this,"resources")}var t=new LegacyPromise;this.resourcesPromise.then(function(){var r=new ObjectLoader(this.resources.map,e,this.xref);r.load().then(function(){t.resolve()})}.bind(this));return t},getOperatorList:function(t,n){function s(e){i.reject(e)}var r=this;var i=new LegacyPromise;var o=new LegacyPromise;var u=this.pdfManager;var a=u.ensure(this,"getContentStream",[]);var f=this.loadResources(["ExtGState","ColorSpace","Pattern","Shading","XObject","Font"]);var l=new PartialEvaluator(u,this.xref,t,this.pageIndex,"p"+this.pageIndex+"_",this.idCounters,this.fontCache);var c=Promise.all([a,f],s);c.then(function(e){var i=e[0];var s=new OperatorList(n,t,r.pageIndex);t.send("StartRenderPage",{transparency:l.hasBlendModes(r.resources),pageIndex:r.pageIndex,intent:n});l.getOperatorList(i,r.resources,s);o.resolve(s)});var h=u.ensure(this,"annotations");Promise.all([o,h]).then(function(e){var t=e[0];var r=e[1];if(r.length===0){t.flush(true);i.resolve(t);return}var o=Annotation.appendToOperatorList(r,t,u,l,n);o.then(function(){t.flush(true);i.resolve(t)},s)},s);return i},extractTextContent:function(){var t={on:function(){},send:function(){}};var n=this;var r=new LegacyPromise;var i=this.pdfManager;var s=i.ensure(this,"getContentStream",[]);var o=this.loadResources(["ExtGState","XObject","Font"]);var u=Promise.all([s,o]);u.then(function(e){var s=e[0];var o=new PartialEvaluator(i,n.xref,t,n.pageIndex,"p"+n.pageIndex+"_",n.idCounters,n.fontCache);var u=o.getTextContent(s,n.resources);r.resolve(u)});return r},getAnnotationsData:function(){var t=this.annotations;var n=[];for(var r=0,i=t.length;r<i;++r){n.push(t[r].getData())}return n},get annotations(){var e=[];var t=this.annotationRefs||[];for(var n=0,r=t.length;n<r;++n){var i=t[n];var s=Annotation.fromRef(this.xref,i);if(s){e.push(s)}}return shadow(this,"annotations",e)}};return n}();var PDFDocument=function(){function t(e,t,r){if(isStream(t)){n.call(this,e,t,r)}else if(isArrayBuffer(t)){n.call(this,e,new Stream(t),r)}else{error("PDFDocument: Unknown argument type")}}function n(e,t,n){assertWellFormed(t.length>0,"stream must have data");this.pdfManager=e;this.stream=t;var r=new XRef(this.stream,n,e);this.xref=r}function r(e,t,n,r){var i=e.pos;var s=e.end;var o=[];if(i+n>s){n=s-i}for(var u=0;u<n;++u){o.push(String.fromCharCode(e.getByte()))}var a=o.join("");e.pos=i;var f=r?a.lastIndexOf(t):a.indexOf(t);if(f==-1){return false}e.pos+=f;return true}var i={get entries(){return shadow(this,"entries",{Title:isString,Author:isString,Subject:isString,Keywords:isString,Creator:isString,Producer:isString,CreationDate:isString,ModDate:isString,Trapped:isName})}};t.prototype={parse:function(t){this.setup(t);try{this.acroForm=this.catalog.catDict.get("AcroForm");if(this.acroForm){this.xfa=this.acroForm.get("XFA");var n=this.acroForm.get("Fields");if((!n||!isArray(n)||n.length===0)&&!this.xfa){this.acroForm=null}}}catch(r){info("Something wrong with AcroForm entry");this.acroForm=null}},get linearization(){var e=this.stream.length;var t=false;if(e){try{t=new Linearization(this.stream);if(t.length!=e){t=false}}catch(n){if(n instanceof MissingDataException){throw n}info("The linearization data is not available "+"or unreadable PDF data is found");t=false}}return shadow(this,"linearization",t)},get startXRef(){var e=this.stream;var t=0;var n=this.linearization;if(n){e.reset();if(r(e,"endobj",1024)){t=e.pos+6}}else{var i=1024;var s=false,o=e.end;while(!s&&o>0){o-=i-"startxref".length;if(o<0){o=0}e.pos=o;s=r(e,"startxref",i,true)}if(s){e.skip(9);var u;do{u=e.getByte()}while(Lexer.isSpace(u));var a="";while(u>=32&&u<=57){a+=String.fromCharCode(u);u=e.getByte()}t=parseInt(a,10);if(isNaN(t)){t=0}}}return shadow(this,"startXRef",t)},get mainXRefEntriesOffset(){var e=0;var t=this.linearization;if(t){e=t.mainXRefEntriesOffset}return shadow(this,"mainXRefEntriesOffset",e)},checkHeader:function(){var t=this.stream;t.reset();if(r(t,"%PDF-",1024)){t.moveStart();var n=12;var i="",s;while((s=t.getByte())>32){if(i.length>=n){break}i+=String.fromCharCode(s)}this.pdfFormatVersion=i.substring(5);return}},parseStartXRef:function(){var t=this.startXRef;this.xref.setStartXRef(t)},setup:function(t){this.xref.parse(t);this.catalog=new Catalog(this.pdfManager,this.xref)},get numPages(){var e=this.linearization;var t=e?e.numPages:this.catalog.numPages;return shadow(this,"numPages",t)},get documentInfo(){var e={PDFFormatVersion:this.pdfFormatVersion,IsAcroFormPresent:!!this.acroForm,IsXFAPresent:!!this.xfa};var t;try{t=this.xref.trailer.get("Info")}catch(n){info("The document information dictionary is invalid.")}if(t){var r=i.entries;for(var s in r){if(t.has(s)){var o=t.get(s);if(r[s](o)){e[s]=typeof o!=="string"?o:stringToPDFString(o)}else{info('Bad value in document info for "'+s+'"')}}}}return shadow(this,"documentInfo",e)},get fingerprint(){var e=this.xref,t,n="";if(e.trailer.has("ID")){t=stringToBytes(e.trailer.get("ID")[0])}else{t=calculateMD5(this.stream.bytes.subarray(0,100),0,100)}for(var r=0,i=t.length;r<i;r++){n+=t[r].toString(16)}return shadow(this,"fingerprint",n)},getPage:function(t){return this.catalog.getPage(t)},cleanup:function(){return this.catalog.cleanup()}};return t}()