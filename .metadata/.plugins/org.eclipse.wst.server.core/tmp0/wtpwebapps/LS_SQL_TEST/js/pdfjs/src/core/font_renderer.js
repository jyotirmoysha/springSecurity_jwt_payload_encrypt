"use strict";var FontRendererFactory=function(){function t(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function n(e,t){return e[t]<<8|e[t+1]}function r(e,r,i){var s=n(e,r+2)===1?t(e,r+8):t(e,r+16);var o=n(e,r+s);if(o===4){var u=n(e,r+s+2);var a=n(e,r+s+6)>>1;var f=r+s+14;var l=[];for(var c=0;c<a;c++,f+=2){l[c]={end:n(e,f)}}f+=2;for(var c=0;c<a;c++,f+=2){l[c].start=n(e,f)}for(var c=0;c<a;c++,f+=2){l[c].idDelta=n(e,f)}for(var c=0;c<a;c++,f+=2){var h=n(e,f);if(h===0){continue}l[c].ids=[];for(var p=0,d=l[c].end-l[c].start+1;p<d;p++){l[c].ids[p]=n(e,f+h);h+=2}}return l}else if(o===12){var u=t(e,r+s+4);var v=t(e,r+s+12);var f=r+s+16;var l=[];for(var c=0;c<v;c++){l.push({start:t(e,f),end:t(e,f+4),idDelta:t(e,f+8)-t(e,f)});f+=12}return l}error("not supported cmap: "+o)}function i(e,t,n){var r={};var i=new CFFParser(new Stream(e,t,n-t),r);var s=i.parse();return{glyphs:s.charStrings.objects,subrs:s.topDict.privateDict&&s.topDict.privateDict.subrsIndex&&s.topDict.privateDict.subrsIndex.objects,gsubrs:s.globalSubrIndex&&s.globalSubrIndex.objects}}function s(e,t,n){var r,i;if(n){r=4;i=function(t,n){return t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3]}}else{r=2;i=function(t,n){return t[n]<<9|t[n+1]<<1}}var s=[];var o=i(t,0);for(var u=r;u<t.length;u+=r){var a=i(t,u);s.push(e.subarray(o,a));o=a}return s}function o(e,t){var n=t.charCodeAt(0);var r=0,i=e.length-1;while(r<i){var s=r+i+1>>1;if(n<e[s].start){i=s-1}else{r=s}}if(e[r].start<=n&&n<=e[r].end){return e[r].idDelta+(e[r].ids?e[r].ids[n-e[r].start]:n)&65535}return 0}function u(e,t,n){function r(e,n){t.push("c.moveTo("+e+","+n+");")}function i(e,n){t.push("c.lineTo("+e+","+n+");")}function s(e,n,r,i){t.push("c.quadraticCurveTo("+e+","+n+","+r+","+i+");")}var o=0;var a=(e[o]<<24|e[o+1]<<16)>>16;var f=(e[o+2]<<24|e[o+3]<<16)>>16;var l=(e[o+4]<<24|e[o+5]<<16)>>16;var c=(e[o+6]<<24|e[o+7]<<16)>>16;var h=(e[o+8]<<24|e[o+9]<<16)>>16;o+=10;if(a<0){var p=0,d=0;do{var v=e[o]<<8|e[o+1];var m=e[o+2]<<8|e[o+3];o+=4;var g,y;if(v&1){g=(e[o]<<24|e[o+1]<<16)>>16;y=(e[o+2]<<24|e[o+3]<<16)>>16;o+=4}else{g=e[o++];y=e[o++]}if(v&2){p=g;d=y}else{p=0;d=0}var b=1,w=1,E=0,S=0;if(v&8){b=w=(e[o]<<24|e[o+1]<<16)/1073741824;o+=2}else if(v&64){b=(e[o]<<24|e[o+1]<<16)/1073741824;w=(e[o+2]<<24|e[o+3]<<16)/1073741824;o+=4}else if(v&128){b=(e[o]<<24|e[o+1]<<16)/1073741824;E=(e[o+2]<<24|e[o+3]<<16)/1073741824;S=(e[o+4]<<24|e[o+5]<<16)/1073741824;w=(e[o+6]<<24|e[o+7]<<16)/1073741824;o+=8}var x=n.glyphs[m];if(x){t.push("c.save();");t.push("c.transform("+b+","+E+","+S+","+w+","+p+","+d+");");u(x,t,n);t.push("c.restore();")}}while(v&32)}else{var T=[];for(var N=0;N<a;N++){T.push(e[o]<<8|e[o+1]);o+=2}var C=e[o]<<8|e[o+1];o+=2+C;var k=T[T.length-1]+1;var L=[];while(L.length<k){var v=e[o++],A=1;if(v&8){A+=e[o++]}while(A-->0){L.push({flags:v})}}var p=0,d=0;for(var N=0;N<k;N++){switch(L[N].flags&18){case 0:p+=(e[o]<<24|e[o+1]<<16)>>16;o+=2;break;case 2:p-=e[o++];break;case 18:p+=e[o++];break}L[N].x=p}for(var N=0;N<k;N++){switch(L[N].flags&36){case 0:d+=(e[o]<<24|e[o+1]<<16)>>16;o+=2;break;case 4:d-=e[o++];break;case 36:d+=e[o++];break}L[N].y=d}var O=0;for(var o=0;o<a;o++){var M=T[o];var _=L.slice(O,M+1);if(_[0].flags&1){_.push(_[0])}else if(_[_.length-1].flags&1){_.unshift(_[_.length-1])}else{var D={flags:1,x:(_[0].x+_[_.length-1].x)/2,y:(_[0].y+_[_.length-1].y)/2};_.unshift(D);_.push(D)}r(_[0].x,_[0].y);for(var N=1,P=_.length;N<P;N++){if(_[N].flags&1){i(_[N].x,_[N].y)}else if(_[N+1].flags&1){s(_[N].x,_[N].y,_[N+1].x,_[N+1].y);N++}else{s(_[N].x,_[N].y,(_[N].x+_[N+1].x)/2,(_[N].y+_[N+1].y)/2)}}O=M+1}}}function a(e,t,n){function f(e,n){t.push("c.moveTo("+e+","+n+");")}function l(e,n){t.push("c.lineTo("+e+","+n+");")}function c(e,n,r,i,s,o){t.push("c.bezierCurveTo("+e+","+n+","+r+","+i+","+s+","+o+");")}function h(e){var p=0;while(p<e.length){var d=false;var v=e[p++];switch(v){case 1:u+=r.length>>1;d=true;break;case 3:u+=r.length>>1;d=true;break;case 4:s+=r.pop();f(i,s);d=true;break;case 5:while(r.length>0){i+=r.shift();s+=r.shift();l(i,s)}break;case 6:while(r.length>0){i+=r.shift();l(i,s);if(r.length===0){break}s+=r.shift();l(i,s)}break;case 7:while(r.length>0){s+=r.shift();l(i,s);if(r.length===0){break}i+=r.shift();l(i,s)}break;case 8:while(r.length>0){var m=i+r.shift(),g=s+r.shift();var b=m+r.shift(),w=g+r.shift();i=b+r.shift();s=w+r.shift();c(m,g,b,w,i,s)}break;case 10:var E=r.pop()+n.subrsBias;var S=n.subrs[E];if(S){h(S)}break;case 11:return;case 12:v=e[p++];switch(v){case 34:var m=i+r.shift();var b=m+r.shift(),T=s+r.shift();i=b+r.shift();c(m,s,b,T,i,T);var m=i+r.shift();var b=m+r.shift();i=b+r.shift();c(m,T,b,s,i,s);break;case 35:var m=i+r.shift(),g=s+r.shift();var b=m+r.shift(),w=g+r.shift();i=b+r.shift();s=w+r.shift();c(m,g,b,w,i,s);var m=i+r.shift(),g=s+r.shift();var b=m+r.shift(),w=g+r.shift();i=b+r.shift();s=w+r.shift();c(m,g,b,w,i,s);r.pop();break;case 36:var m=i+r.shift(),T=s+r.shift();var b=m+r.shift(),N=T+r.shift();i=b+r.shift();c(m,T,b,N,i,N);var m=i+r.shift();var b=m+r.shift(),C=N+r.shift();i=b+r.shift();c(m,N,b,C,i,s);break;case 37:var k=i,L=s;var m=i+r.shift(),g=s+r.shift();var b=m+r.shift(),w=g+r.shift();i=b+r.shift();s=w+r.shift();c(m,g,b,w,i,s);var m=i+r.shift(),g=s+r.shift();var b=m+r.shift(),w=g+r.shift();i=b;s=w;if(Math.abs(i-k)>Math.abs(s-L)){i+=r.shift()}else{s+=r.shift()}c(m,g,b,w,i,s);break;default:error("unknown operator: 12 "+v)}break;case 14:if(r.length>=4){var A=r.pop();var O=r.pop();s=r.pop();i=r.pop();t.push("c.save();");t.push("c.translate("+i+","+s+");");var M=o(n.cmap,String.fromCharCode(n.glyphNameMap[Encodings.StandardEncoding[A]]));a(n.glyphs[M],t,n);t.push("c.restore();");M=o(n.cmap,String.fromCharCode(n.glyphNameMap[Encodings.StandardEncoding[O]]));a(n.glyphs[M],t,n)}return;case 18:u+=r.length>>1;d=true;break;case 19:u+=r.length>>1;p+=u+7>>3;d=true;break;case 20:u+=r.length>>1;p+=u+7>>3;d=true;break;case 21:s+=r.pop();i+=r.pop();f(i,s);d=true;break;case 22:i+=r.pop();f(i,s);d=true;break;case 23:u+=r.length>>1;d=true;break;case 24:while(r.length>2){var m=i+r.shift(),g=s+r.shift();var b=m+r.shift(),w=g+r.shift();i=b+r.shift();s=w+r.shift();c(m,g,b,w,i,s)}i+=r.shift();s+=r.shift();l(i,s);break;case 25:while(r.length>6){i+=r.shift();s+=r.shift();l(i,s)}var m=i+r.shift(),g=s+r.shift();var b=m+r.shift(),w=g+r.shift();i=b+r.shift();s=w+r.shift();c(m,g,b,w,i,s);break;case 26:if(r.length%2){i+=r.shift()}while(r.length>0){var m=i,g=s+r.shift();var b=m+r.shift(),w=g+r.shift();i=b;s=w+r.shift();c(m,g,b,w,i,s)}break;case 27:if(r.length%2){s+=r.shift()}while(r.length>0){var m=i+r.shift(),g=s;var b=m+r.shift(),w=g+r.shift();i=b+r.shift();s=w;c(m,g,b,w,i,s)}break;case 28:r.push((e[p]<<24|e[p+1]<<16)>>16);p+=2;break;case 29:var E=r.pop()+n.gsubrsBias;var S=n.gsubrs[E];if(S){h(S)}break;case 30:while(r.length>0){var m=i,g=s+r.shift();var b=m+r.shift(),w=g+r.shift();i=b+r.shift();s=w+(r.length===1?r.shift():0);c(m,g,b,w,i,s);if(r.length===0){break}var m=i+r.shift(),g=s;var b=m+r.shift(),w=g+r.shift();s=w+r.shift();i=b+(r.length===1?r.shift():0);c(m,g,b,w,i,s)}break;case 31:while(r.length>0){var m=i+r.shift(),g=s;var b=m+r.shift(),w=g+r.shift();s=w+r.shift();i=b+(r.length===1?r.shift():0);c(m,g,b,w,i,s);if(r.length===0){break}var m=i,g=s+r.shift();var b=m+r.shift(),w=g+r.shift();i=b+r.shift();s=w+(r.length===1?r.shift():0);c(m,g,b,w,i,s)}break;default:if(v<32){error("unknown operator: "+v)}if(v<247){r.push(v-139)}else if(v<251){r.push((v-247)*256+e[p++]+108)}else if(v<255){r.push(-(v-251)*256-e[p++]-108)}else{r.push((e[p]<<24|e[p+1]<<16|e[p+2]<<8|e[p+3])/65536);p+=4}break}if(d){r.length=0}}}var r=[];var i=0,s=0;var u=0;h(e)}function l(e){this.compiledGlyphs={};this.fontMatrix=e}function c(e,t,n){n=n||[488e-6,0,0,488e-6,0,0];l.call(this,n);this.glyphs=e;this.cmap=t;this.compiledGlyphs=[]}function h(e,t,n,r){n=n||[.001,0,0,.001,0,0];l.call(this,n);this.glyphs=e.glyphs;this.gsubrs=e.gsubrs||[];this.subrs=e.subrs||[];this.cmap=t;this.glyphNameMap=r||GlyphsUnicode;this.compiledGlyphs=[];this.gsubrsBias=this.gsubrs.length<1240?107:this.gsubrs.length<33900?1131:32768;this.subrsBias=this.subrs.length<1240?107:this.subrs.length<33900?1131:32768}var f="";l.prototype={getPathJs:function(e){var t=o(this.cmap,e);var n=this.compiledGlyphs[t];if(!n){this.compiledGlyphs[t]=n=this.compileGlyph(this.glyphs[t])}return n},compileGlyph:function(e){if(!e||e.length===0||e[0]===14){return f}var t=[];t.push("c.save();");t.push("c.transform("+this.fontMatrix.join(",")+");");t.push("c.scale(size, -size);");this.compileGlyphImpl(e,t);t.push("c.restore();");return t.join("\n")},compileGlyphImpl:function(){error("Children classes should implement this.")},hasBuiltPath:function(e){var t=o(this.cmap,e);return t in this.compiledGlyphs}};Util.inherit(c,l,{compileGlyphImpl:function(e,t){u(e,t,this)}});Util.inherit(h,l,{compileGlyphImpl:function(e,t){a(e,t,this)}});return{create:function(o){var u=new Uint8Array(o.data);var a,f,l,p,d,v;var m=n(u,4);for(var g=0,y=12;g<m;g++,y+=16){var b=String.fromCharCode.apply(null,u.subarray(y,y+4));var w=t(u,y+8);var E=t(u,y+12);switch(b){case"cmap":a=r(u,w,w+E);break;case"glyf":f=u.subarray(w,w+E);break;case"loca":l=u.subarray(w,w+E);break;case"head":v=n(u,w+18);d=n(u,w+50);break;case"CFF ":p=i(u,w,w+E);break}}if(f){var S=!v?o.fontMatrix:[1/v,0,0,1/v,0,0];return new c(s(f,l,d),a,S)}else{return new h(p,a,o.fontMatrix,o.glyphNameMap)}}}}()