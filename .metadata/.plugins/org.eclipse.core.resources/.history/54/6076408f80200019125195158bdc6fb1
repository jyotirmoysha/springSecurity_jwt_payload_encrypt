"use strict";var ColorSpace=function(){function t(){error("should not call ColorSpace constructor")}t.prototype={getRgb:function(t,n){var r=new Uint8Array(3);this.getRgbItem(t,n,r,0);return r},getRgbItem:function(t,n,r,i){error("Should not call ColorSpace.getRgbItem")},getRgbBuffer:function(t,n,r,i,s,o,u){error("Should not call ColorSpace.getRgbBuffer")},getOutputLength:function(t,n){error("Should not call ColorSpace.getOutputLength")},isPassthrough:function(t){return false},fillRgb:function(t,n,r,i,s,o,u,a,f){var l=n*r;var c=null;var h=1<<u;var p=r!=s||n!=i;if(this.isPassthrough(u)){c=a}else if(this.numComps===1&&l>h&&this.name!=="DeviceGray"&&this.name!=="DeviceRGB"){var d=u<=8?new Uint8Array(h):new Uint16Array(h);for(var v=0;v<h;v++){d[v]=v}var m=new Uint8Array(h*3);this.getRgbBuffer(d,0,h,m,0,u,0);if(!p){var g=0;for(var v=0;v<l;++v){var y=a[v]*3;t[g++]=m[y];t[g++]=m[y+1];t[g++]=m[y+2];g+=f}}else{c=new Uint8Array(l*3);var b=0;for(var v=0;v<l;++v){var y=a[v]*3;c[b++]=m[y];c[b++]=m[y+1];c[b++]=m[y+2]}}}else{if(!p){this.getRgbBuffer(a,0,i*o,t,0,u,f)}else{c=new Uint8Array(l*3);this.getRgbBuffer(a,0,l,c,0,u,0)}}if(c){if(p){c=PDFImage.resize(c,u,3,n,r,i,s)}var b=0;var g=0;for(var v=0,w=i*o;v<w;v++){t[g++]=c[b++];t[g++]=c[b++];t[g++]=c[b++];g+=f}}},usesZeroToOneRange:true};t.parse=function(n,r,i){var s=t.parseToIR(n,r,i);if(s instanceof AlternateCS){return s}return t.fromIR(s)};t.fromIR=function(n){var r=isArray(n)?n[0]:n;switch(r){case"DeviceGrayCS":return this.singletons.gray;case"DeviceRgbCS":return this.singletons.rgb;case"DeviceCmykCS":return this.singletons.cmyk;case"CalGrayCS":var i=n[1].WhitePoint;var s=n[1].BlackPoint;var o=n[1].Gamma;return new CalGrayCS(i,s,o);case"PatternCS":var u=n[1];if(u){u=t.fromIR(u)}return new PatternCS(u);case"IndexedCS":var a=n[1];var f=n[2];var l=n[3];return new IndexedCS(t.fromIR(a),f,l);case"AlternateCS":var c=n[1];var h=n[2];var p=n[3];return new AlternateCS(c,t.fromIR(h),PDFFunction.fromIR(p));case"LabCS":var i=n[1].WhitePoint;var s=n[1].BlackPoint;var d=n[1].Range;return new LabCS(i,s,d);default:error("Unkown name "+r)}return null};t.parseToIR=function(n,r,i){if(isName(n)){var s=i.get("ColorSpace");if(isDict(s)){var o=s.get(n.name);if(o){n=o}}}n=r.fetchIfRef(n);var u;if(isName(n)){u=n.name;this.mode=u;switch(u){case"DeviceGray":case"G":return"DeviceGrayCS";case"DeviceRGB":case"RGB":return"DeviceRgbCS";case"DeviceCMYK":case"CMYK":return"DeviceCmykCS";case"Pattern":return["PatternCS",null];default:error("unrecognized colorspace "+u)}}else if(isArray(n)){u=n[0].name;this.mode=u;switch(u){case"DeviceGray":case"G":return"DeviceGrayCS";case"DeviceRGB":case"RGB":return"DeviceRgbCS";case"DeviceCMYK":case"CMYK":return"DeviceCmykCS";case"CalGray":var a=n[1].getAll();return["CalGrayCS",a];case"CalRGB":return"DeviceRgbCS";case"ICCBased":var f=r.fetchIfRef(n[1]);var l=f.dict;var c=l.get("N");if(c==1){return"DeviceGrayCS"}else if(c==3){return"DeviceRgbCS"}else if(c==4){return"DeviceCmykCS"}break;case"Pattern":var h=n[1];if(h){h=t.parseToIR(h,r,i)}return["PatternCS",h];case"Indexed":case"I":var p=t.parseToIR(n[1],r,i);var d=n[2]+1;var v=r.fetchIfRef(n[3]);if(isStream(v)){v=v.getBytes()}return["IndexedCS",p,d,v];case"Separation":case"DeviceN":var m=n[1];var c=1;if(isName(m)){c=1}else if(isArray(m)){c=m.length}var g=t.parseToIR(n[2],r,i);var y=PDFFunction.getIR(r,r.fetchIfRef(n[3]));return["AlternateCS",c,g,y];case"Lab":var a=n[1].getAll();return["LabCS",a];default:error('unimplemented color space object "'+u+'"')}}else{error('unrecognized color space object: "'+n+'"')}return null};t.isDefaultDecode=function(t,n){if(!t){return true}if(n*2!==t.length){warn("The decode map is not the correct length");return true}for(var r=0,i=t.length;r<i;r+=2){if(t[r]!==0||t[r+1]!=1){return false}}return true};t.singletons={get gray(){return shadow(this,"gray",new DeviceGrayCS)},get rgb(){return shadow(this,"rgb",new DeviceRgbCS)},get cmyk(){return shadow(this,"cmyk",new DeviceCmykCS)}};return t}();var AlternateCS=function(){function t(e,t,n){this.name="Alternate";this.numComps=e;this.defaultColor=new Float32Array(e);for(var r=0;r<e;++r){this.defaultColor[r]=1}this.base=t;this.tintFn=n}t.prototype={getRgb:ColorSpace.prototype.getRgb,getRgbItem:function(t,n,r,i){var s=this.base.numComps;var o="subarray"in t?t.subarray(n,n+this.numComps):Array.prototype.slice.call(t,n,n+this.numComps);var u=this.tintFn(o);this.base.getRgbItem(u,0,r,i)},getRgbBuffer:function(t,n,r,i,s,o,u){var a=this.tintFn;var f=this.base;var l=1/((1<<o)-1);var c=f.numComps;var h=f.usesZeroToOneRange;var p=(f.isPassthrough(8)||!h)&&u===0;var d=p?s:0;var v=p?i:new Uint8Array(c*r);var m=this.numComps;var g=new Float32Array(m);for(var y=0;y<r;y++){for(var b=0;b<m;b++){g[b]=t[n++]*l}var w=a(g);if(h){for(var b=0;b<c;b++){v[d++]=w[b]*255}}else{f.getRgbItem(w,0,v,d);d+=c}}if(!p){f.getRgbBuffer(v,0,r,i,s,8,u)}},getOutputLength:function(t,n){return this.base.getOutputLength(t*this.base.numComps/this.numComps,n)},isPassthrough:ColorSpace.prototype.isPassthrough,fillRgb:ColorSpace.prototype.fillRgb,isDefaultDecode:function(t){return ColorSpace.isDefaultDecode(t,this.numComps)},usesZeroToOneRange:true};return t}();var PatternCS=function(){function t(e){this.name="Pattern";this.base=e}t.prototype={};return t}();var IndexedCS=function(){function t(e,t,n){this.name="Indexed";this.numComps=1;this.defaultColor=new Uint8Array([0]);this.base=e;this.highVal=t;var r=e.numComps;var i=r*t;var s;if(isStream(n)){s=new Uint8Array(i);var o=n.getBytes(i);s.set(o)}else if(isString(n)){s=new Uint8Array(i);for(var u=0;u<i;++u){s[u]=n.charCodeAt(u)}}else if(n instanceof Uint8Array||n instanceof Array){s=n}else{error("Unrecognized lookup table: "+n)}this.lookup=s}t.prototype={getRgb:ColorSpace.prototype.getRgb,getRgbItem:function(t,n,r,i){var s=this.base.numComps;var o=t[n]*s;this.base.getRgbItem(this.lookup,o,r,i)},getRgbBuffer:function(t,n,r,i,s,o,u){var a=this.base;var f=a.numComps;var l=a.getOutputLength(f,u);var c=this.lookup;for(var h=0;h<r;++h){var p=t[n++]*f;a.getRgbBuffer(c,p,1,i,s,8,u);s+=l}},getOutputLength:function(t,n){return this.base.getOutputLength(t*this.base.numComps,n)},isPassthrough:ColorSpace.prototype.isPassthrough,fillRgb:ColorSpace.prototype.fillRgb,isDefaultDecode:function(t){return true},usesZeroToOneRange:true};return t}();var DeviceGrayCS=function(){function t(){this.name="DeviceGray";this.numComps=1;this.defaultColor=new Float32Array([0])}t.prototype={getRgb:ColorSpace.prototype.getRgb,getRgbItem:function(t,n,r,i){var s=t[n]*255|0;s=s<0?0:s>255?255:s;r[i]=r[i+1]=r[i+2]=s},getRgbBuffer:function(t,n,r,i,s,o,u){var a=255/((1<<o)-1);var f=n,l=s;for(var c=0;c<r;++c){var h=a*t[f++]|0;i[l++]=h;i[l++]=h;i[l++]=h;l+=u}},getOutputLength:function(t,n){return t*(3+n)},isPassthrough:ColorSpace.prototype.isPassthrough,fillRgb:ColorSpace.prototype.fillRgb,isDefaultDecode:function(t){return ColorSpace.isDefaultDecode(t,this.numComps)},usesZeroToOneRange:true};return t}();var DeviceRgbCS=function(){function t(){this.name="DeviceRGB";this.numComps=3;this.defaultColor=new Float32Array([0,0,0])}t.prototype={getRgb:ColorSpace.prototype.getRgb,getRgbItem:function(t,n,r,i){var s=t[n]*255|0;var o=t[n+1]*255|0;var u=t[n+2]*255|0;r[i]=s<0?0:s>255?255:s;r[i+1]=o<0?0:o>255?255:o;r[i+2]=u<0?0:u>255?255:u},getRgbBuffer:function(t,n,r,i,s,o,u){if(o===8&&u===0){i.set(t.subarray(n,n+r*3),s);return}var a=255/((1<<o)-1);var f=n,l=s;for(var c=0;c<r;++c){i[l++]=a*t[f++]|0;i[l++]=a*t[f++]|0;i[l++]=a*t[f++]|0;l+=u}},getOutputLength:function(t,n){return t*(3+n)/3|0},isPassthrough:function(t){return t==8},fillRgb:ColorSpace.prototype.fillRgb,isDefaultDecode:function(t){return ColorSpace.isDefaultDecode(t,this.numComps)},usesZeroToOneRange:true};return t}();var DeviceCmykCS=function(){function t(e,t,n,r,i){var s=e[t+0]*n;var o=e[t+1]*n;var u=e[t+2]*n;var a=e[t+3]*n;var f=s*(-4.387332384609988*s+54.48615194189176*o+18.82290502165302*u+212.25662451639585*a+ -285.2331026137004)+o*(1.7149763477362134*o-5.6096736904047315*u+ -17.873870861415444*a-5.497006427196366)+u*(-2.5217340131683033*u-21.248923337353073*a+17.5119270841813)+a*(-21.86122147463605*a-189.48180835922747)+255;var l=s*(8.841041422036149*s+60.118027045597366*o+6.871425592049007*u+31.159100130055922*a+ -79.2970844816548)+o*(-15.310361306967817*o+17.575251261109482*u+131.35250912493976*a-190.9453302588951)+u*(4.444339102852739*u+9.8632861493405*a-24.86741582555878)+a*(-20.737325471181034*a-187.80453709719578)+255;var c=s*(.8842522430003296*s+8.078677503112928*o+30.89978309703729*u-.23883238689178934*a+ -14.183576799673286)+o*(10.49593273432072*o+63.02378494754052*u+50.606957656360734*a-112.23884253719248)+u*(.03296041114873217*u+115.60384449646641*a+ -193.58209356861505)+a*(-22.33816807309886*a-180.12613974708367)+255;r[i]=f>255?255:f<0?0:f;r[i+1]=l>255?255:l<0?0:l;r[i+2]=c>255?255:c<0?0:c}function n(){this.name="DeviceCMYK";this.numComps=4;this.defaultColor=new Float32Array([0,0,0,1])}n.prototype={getRgb:ColorSpace.prototype.getRgb,getRgbItem:function(n,r,i,s){t(n,r,1,i,s)},getRgbBuffer:function(n,r,i,s,o,u,a){var f=1/((1<<u)-1);for(var l=0;l<i;l++){t(n,r,f,s,o);r+=4;o+=3+a}},getOutputLength:function(t,n){return t/4*(3+n)|0},isPassthrough:ColorSpace.prototype.isPassthrough,fillRgb:ColorSpace.prototype.fillRgb,isDefaultDecode:function(t){return ColorSpace.isDefaultDecode(t,this.numComps)},usesZeroToOneRange:true};return n}();var CalGrayCS=function(){function t(e,t,n){this.name="CalGray";this.numComps=1;this.defaultColor=new Float32Array([0]);if(!e){error("WhitePoint missing - required for color space CalGray")}t=t||[0,0,0];n=n||1;this.XW=e[0];this.YW=e[1];this.ZW=e[2];this.XB=t[0];this.YB=t[1];this.ZB=t[2];this.G=n;if(this.XW<0||this.ZW<0||this.YW!==1){error("Invalid WhitePoint components for "+this.name+", no fallback available")}if(this.XB<0||this.YB<0||this.ZB<0){info("Invalid BlackPoint for "+this.name+", falling back to default");this.XB=this.YB=this.ZB=0}if(this.XB!==0||this.YB!==0||this.ZB!==0){warn(this.name+", BlackPoint: XB: "+this.XB+", YB: "+this.YB+", ZB: "+this.ZB+", only default values are supported.")}if(this.G<1){info("Invalid Gamma: "+this.G+" for "+this.name+", falling back to default");this.G=1}}function n(e,t,n,r,i,s){var o=t[n]*s;var u=Math.pow(o,e.G);var a=e.XW*u;var f=e.YW*u;var l=e.ZW*u;var c=a;var h=f;var p=l;var d=Math.max(116*Math.pow(h,1/3)-16,0);r[i]=d*255/100;r[i+1]=d*255/100;r[i+2]=d*255/100}t.prototype={getRgb:ColorSpace.prototype.getRgb,getRgbItem:function(t,r,i,s){n(this,t,r,i,s,1)},getRgbBuffer:function(t,r,i,s,o,u,a){var f=1/((1<<u)-1);for(var l=0;l<i;++l){n(this,t,r,s,o,f);r+=1;o+=3+a}},getOutputLength:function(t,n){return t*(3+n)},isPassthrough:ColorSpace.prototype.isPassthrough,fillRgb:ColorSpace.prototype.fillRgb,isDefaultDecode:function(t){return ColorSpace.isDefaultDecode(t,this.numComps)},usesZeroToOneRange:true};return t}();var LabCS=function(){function t(e,t,n){this.name="Lab";this.numComps=3;this.defaultColor=new Float32Array([0,0,0]);if(!e){error("WhitePoint missing - required for color space Lab")}t=t||[0,0,0];n=n||[-100,100,-100,100];this.XW=e[0];this.YW=e[1];this.ZW=e[2];this.amin=n[0];this.amax=n[1];this.bmin=n[2];this.bmax=n[3];this.XB=t[0];this.YB=t[1];this.ZB=t[2];if(this.XW<0||this.ZW<0||this.YW!==1){error("Invalid WhitePoint components, no fallback available")}if(this.XB<0||this.YB<0||this.ZB<0){info("Invalid BlackPoint, falling back to default");this.XB=this.YB=this.ZB=0}if(this.amin>this.amax||this.bmin>this.bmax){info("Invalid Range, falling back to defaults");this.amin=-100;this.amax=100;this.bmin=-100;this.bmax=100}}function n(e){if(e>=6/29){return e*e*e}else{return 108/841*(e-4/29)}}function r(e,t,n,r){return n+e*(r-n)/t}function i(e,t,i,s,o,u){var a=t[i];var f=t[i+1];var l=t[i+2];if(s!==false){a=r(a,s,0,100);f=r(f,s,e.amin,e.amax);l=r(l,s,e.bmin,e.bmax)}f=f>e.amax?e.amax:f<e.amin?e.amin:f;l=l>e.bmax?e.bmax:l<e.bmin?e.bmin:l;var c=(a+16)/116;var h=c+f/500;var p=c-l/200;var d=e.XW*n(h);var v=e.YW*n(c);var m=e.ZW*n(p);var g,y,b;if(e.ZW<1){g=d*3.1339+v*-1.617+m*-.4906;y=d*-.9785+v*1.916+m*.0333;b=d*.072+v*-.229+m*1.4057}else{g=d*3.2406+v*-1.5372+m*-.4986;y=d*-.9689+v*1.8758+m*.0415;b=d*.0557+v*-.204+m*1.057}o[u]=g<=0?0:g>=1?255:Math.sqrt(g)*255|0;o[u+1]=y<=0?0:y>=1?255:Math.sqrt(y)*255|0;o[u+2]=b<=0?0:b>=1?255:Math.sqrt(b)*255|0}t.prototype={getRgb:ColorSpace.prototype.getRgb,getRgbItem:function(t,n,r,s){i(this,t,n,false,r,s)},getRgbBuffer:function(t,n,r,s,o,u,a){var f=(1<<u)-1;for(var l=0;l<r;l++){i(this,t,n,f,s,o);n+=3;o+=3+a}},getOutputLength:function(t,n){return t*(3+n)/3|0},isPassthrough:ColorSpace.prototype.isPassthrough,isDefaultDecode:function(t){return true},usesZeroToOneRange:false};return t}()