"use strict";var WorkerMessageHandler=PDFJS.WorkerMessageHandler={setup:function(t){function r(e){var t=new LegacyPromise;var r=function(){var r=n.ensureDoc("numPages");var s=n.ensureDoc("fingerprint");var o=n.ensureCatalog("documentOutline");var u=n.ensureDoc("documentInfo");var a=n.ensureCatalog("metadata");var f=n.ensureXRef("encrypt");var l=n.ensureCatalog("javaScript");Promise.all([r,s,o,u,a,f,l]).then(function(n){var r={numPages:n[0],fingerprint:n[1],outline:n[2],info:n[3],metadata:n[4],encrypted:!!n[5],javaScript:n[6]};t.resolve(r)},i)};var i=function(n){t.reject(n)};n.ensureDoc("checkHeader",[]).then(function(){n.ensureDoc("parseStartXRef",[]).then(function(){n.ensureDoc("parse",[e]).then(r,i)},i)},i);return t}function i(e){var r=new LegacyPromise;var i=e.source;var s=e.disableRange;if(i.data){try{n=new LocalPdfManager(i.data,i.password);r.resolve()}catch(o){r.reject(o)}return r}else if(i.chunkedViewerLoading){try{n=new NetworkPdfManager(i,t);r.resolve()}catch(o){r.reject(o)}return r}var u=new NetworkManager(i.url,{httpHeaders:i.httpHeaders,withCredentials:i.withCredentials});var a=u.requestFull({onHeadersReceived:function(){if(s){return}var o=u.getRequestXhr(a);if(o.getResponseHeader("Accept-Ranges")!=="bytes"){return}var f=o.getResponseHeader("Content-Encoding")||"identity";if(f!=="identity"){return}var l=o.getResponseHeader("Content-Length");l=parseInt(l,10);if(!isInt(l)){return}i.length=l;if(l<=2*RANGE_CHUNK_SIZE){return}u.abortRequest(a);try{n=new NetworkPdfManager(i,t);r.resolve(n)}catch(c){r.reject(c)}},onDone:function(t){try{n=new LocalPdfManager(t.chunk,i.password);r.resolve()}catch(s){r.reject(s)}},onError:function(n){if(n==404){var r=new MissingPDFException('Missing PDF "'+i.url+'".');t.send("MissingPDF",{exception:r})}else{t.send("DocError","Unexpected server response ("+n+') while retrieving PDF "'+i.url+'".')}},onProgress:function(n){t.send("DocProgress",{loaded:n.loaded,total:n.lengthComputable?n.total:i.length})}});return r}var n;t.on("test",function(n){if(!(n instanceof Uint8Array)){t.send("test",false);return}var r=n[0]===255;t.postMessageTransfers=r;var i=new XMLHttpRequest;var s="response"in i;try{var o=i.responseType}catch(u){s=false}if(!s){t.send("test",false);return}t.send("test",{supportTypedArray:true,supportTransfers:r})});t.on("GetDocRequest",function(s){var o=function(e){t.send("GetDoc",{pdfInfo:e})};var u=function(e){if(e instanceof PasswordException){if(e.code===PasswordResponses.NEED_PASSWORD){t.send("NeedPassword",{exception:e})}else if(e.code===PasswordResponses.INCORRECT_PASSWORD){t.send("IncorrectPassword",{exception:e})}}else if(e instanceof InvalidPDFException){t.send("InvalidPDF",{exception:e})}else if(e instanceof MissingPDFException){t.send("MissingPDF",{exception:e})}else{t.send("UnknownError",{exception:new UnknownErrorException(e.message,e.toString())})}};PDFJS.maxImageSize=s.maxImageSize===undefined?-1:s.maxImageSize;PDFJS.disableFontFace=s.disableFontFace;PDFJS.disableCreateObjectURL=s.disableCreateObjectURL;PDFJS.verbosity=s.verbosity;PDFJS.cMapUrl=s.cMapUrl===undefined?null:s.cMapUrl;PDFJS.cMapPacked=s.cMapPacked===true;i(s).then(function(){n.onLoadedStream().then(function(e){t.send("DataLoaded",{length:e.bytes.byteLength})})}).then(function a(){r(false).then(o,function(t){if(!(t instanceof XRefParseException)){if(t instanceof PasswordException){n.passwordChangedPromise=new LegacyPromise;n.passwordChangedPromise.then(a)}u(t);return}n.requestLoadedStream();n.onLoadedStream().then(function(){r(true).then(o,u)})},u)},u)});t.on("GetPageRequest",function(r){var i=r.pageIndex;n.getPage(i).then(function(e){var i=n.ensure(e,"rotate");var s=n.ensure(e,"ref");var o=n.ensure(e,"view");Promise.all([i,s,o]).then(function(e){var n={pageIndex:r.pageIndex,rotate:e[0],ref:e[1],view:e[2]};t.send("GetPage",{pageInfo:n})})})});t.on("GetPageIndex",function(t,r){var i=new Ref(t.ref.num,t.ref.gen);var s=n.pdfDocument.catalog;s.getPageIndex(i).then(function(e){r.resolve(e)},r.reject)});t.on("GetDestinations",function(t,r){n.ensureCatalog("destinations").then(function(e){r.resolve(e)})});t.on("GetData",function(t,r){n.requestLoadedStream();n.onLoadedStream().then(function(e){r.resolve(e.bytes)})});t.on("UpdatePassword",function(t){n.updatePassword(t)});t.on("GetAnnotationsRequest",function(r){n.getPage(r.pageIndex).then(function(e){n.ensure(e,"getAnnotationsData",[]).then(function(e){t.send("GetAnnotations",{pageIndex:r.pageIndex,annotations:e})})})});t.on("RenderPageRequest",function(r){n.getPage(r.pageIndex).then(function(e){var n=r.pageIndex+1;var i=Date.now();e.getOperatorList(t,r.intent).then(function(e){info("page="+n+" - getOperatorList: time="+(Date.now()-i)+"ms, len="+e.fnArray.length)},function(e){var i="worker.js: while trying to getPage() and getOperatorList()";var s;if(typeof e==="string"){s={message:e,stack:i}}else if(typeof e==="object"){s={message:e.message||e.toString(),stack:e.stack||i}}else{s={message:"Unknown exception type: "+typeof e,stack:i}}t.send("PageError",{pageNum:n,error:s,intent:r.intent})})})},this);t.on("GetTextContent",function(t,r){n.getPage(t.pageIndex).then(function(e){var n=t.pageIndex+1;var i=Date.now();e.extractTextContent().then(function(e){r.resolve(e);info("text indexing: page="+n+" - time="+(Date.now()-i)+"ms")},function(e){r.reject(e)})})});t.on("Cleanup",function(t,r){n.cleanup();r.resolve(true)});t.on("Terminate",function(t,r){n.terminate();r.resolve()})}};var consoleTimer={};var workerConsole={log:function(){var t=Array.prototype.slice.call(arguments);globalScope.postMessage({action:"console_log",data:t})},error:function(){var t=Array.prototype.slice.call(arguments);globalScope.postMessage({action:"console_error",data:t});throw"pdf.js execution error"},time:function(t){consoleTimer[t]=Date.now()},timeEnd:function(t){var n=consoleTimer[t];if(!n){error("Unknown timer name "+t)}this.log("Timer:",t,Date.now()-n)}};if(typeof window==="undefined"){if(!("console"in globalScope)){globalScope.console=workerConsole}PDFJS.UnsupportedManager.listen(function(e){globalScope.postMessage({action:"_unsupported_feature",data:e})});var handler=new MessageHandler("worker_processor",this);WorkerMessageHandler.setup(handler)}