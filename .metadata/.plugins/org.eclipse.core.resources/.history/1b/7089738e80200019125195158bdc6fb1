function incHex(e){var t=1,n="";for(var r=e.length-1;r>=0;r--){t+=parseInt(e[r],16);if(t>=16){n="0"+n;t=1}else{n=t.toString(16)+n;t=0}}return n}exports.optimizeCMap=function(e){var t=1;while(t<e.body.length){if(e.body[t-1].type===e.body[t].type){e.body[t-1].items=e.body[t-1].items.concat(e.body[t].items);e.body.splice(t,1)}else{t++}}var t=0;while(t<e.body.length){var n=e.body[t];var r=Object.keys(n.items[0]).filter(function(e){return typeof n.items[0][e]==="string"});var i=1;while(i<n.items.length){var s=false;for(var o=0;o<r.length&&!s;o++){s=n.items[i-1][r[o]].length!==n.items[i][r[o]].length}if(s){break}i++}if(i<n.items.length){e.body.splice(t+1,0,{type:n.type,items:n.items.splice(i,n.items.length-i)})}t++}var t=0;while(t<e.body.length){var n=e.body[t];if(n.type===3||n.type===5){var i=0;while(i<n.items.length){var o=i;while(i<n.items.length&&n.items[i].start===n.items[i].end){i++}if(i-o>=9){if(i<n.items.length){e.body.splice(t+1,0,{type:n.type,items:n.items.splice(i,n.items.length-i)})}if(o>0){e.body.splice(t+1,0,{type:n.type-1,items:n.items.splice(o,i-o).map(function(e){return{"char":e.start,code:e.code}})});t++}else{n.type-=1;n.items=n.items.map(function(e){return{"char":e.start,code:e.code}})}continue}i++}}t++}var t=0;while(t<e.body.length){var n=e.body[t];if(n.type>=2&&n.type<=5){var i=1;var u=n.type===2||n.type===4?"char":"start";var a=n.type===2||n.type===4?"char":"end";while(i<n.items.length){var o=i-1;while(i<n.items.length&&incHex(n.items[i-1][a])===n.items[i][u]){i++}if(i-o>=9){if(i<n.items.length){e.body.splice(t+1,0,{type:n.type,items:n.items.splice(i,n.items.length-i)})}if(o>0){e.body.splice(t+1,0,{type:n.type,items:n.items.splice(o,i-o),sequence:true});t++}else{n.sequence=true}continue}i++}}t++}var t=0;while(t<e.body.length){var n=e.body[t];if(!n.sequence&&(n.type===2||n.type===3)){var f=n.items;var l=f.map(function(e){return e.code});l.sort(function(e,t){return e-t});var c=100,h=10,p=50;if(f.length>h&&l[l.length-1]-l[0]>c){var d=Math.max(2,f.length/p|0);var v=[];for(var o=0;o<d;o++){v.push({length:0})}for(var i=1;i<l.length;i++){var m=l[i]-l[i-1];var o=0;while(o<v.length&&v[o].length>m){o++}if(o>=v.length){continue}var g=o;while(o<v.length){if(v[o].length<v[g].length){g=o}o++}v[g]={length:m,boundary:l[i]}}var y=v.filter(function(e){return e.length>=c}).map(function(e){return e.boundary});y.sort(function(e,t){return e-t});if(y.length>1){var b=[n.items=[]];for(var i=0;i<y.length;i++){var w={type:n.type,items:[]};b.push(w.items);t++;e.body.splice(t,0,w)}for(var i=0;i<f.length;i++){var E=f[i].code;var o=0;while(o<y.length&&y[o]<=E){o++}b[o].push(f[i])}}}}t++}}