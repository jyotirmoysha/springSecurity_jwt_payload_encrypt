"use strict";function createScratchCanvas(e,t){var n=document.createElement("canvas");n.width=e;n.height=t;return n}function addContextCurrentTransform(e){if(!e.mozCurrentTransform){e._scaleX=e._scaleX||1;e._scaleY=e._scaleY||1;e._originalSave=e.save;e._originalRestore=e.restore;e._originalRotate=e.rotate;e._originalScale=e.scale;e._originalTranslate=e.translate;e._originalTransform=e.transform;e._originalSetTransform=e.setTransform;e._transformMatrix=[e._scaleX,0,0,e._scaleY,0,0];e._transformStack=[];Object.defineProperty(e,"mozCurrentTransform",{get:function(){return this._transformMatrix}});Object.defineProperty(e,"mozCurrentTransformInverse",{get:function(){var t=this._transformMatrix;var n=t[0],r=t[1],i=t[2],s=t[3],o=t[4],u=t[5];var a=n*s-r*i;var f=r*i-n*s;return[s/a,r/f,i/f,n/a,(s*o-i*u)/f,(r*o-n*u)/a]}});e.save=function(){var t=this._transformMatrix;this._transformStack.push(t);this._transformMatrix=t.slice(0,6);this._originalSave()};e.restore=function(){var t=this._transformStack.pop();if(t){this._transformMatrix=t;this._originalRestore()}};e.translate=function(t,n){var r=this._transformMatrix;r[4]=r[0]*t+r[2]*n+r[4];r[5]=r[1]*t+r[3]*n+r[5];this._originalTranslate(t,n)};e.scale=function(t,n){var r=this._transformMatrix;r[0]=r[0]*t;r[1]=r[1]*t;r[2]=r[2]*n;r[3]=r[3]*n;this._originalScale(t,n)};e.transform=function(n,r,i,s,o,u){var a=this._transformMatrix;this._transformMatrix=[a[0]*n+a[2]*r,a[1]*n+a[3]*r,a[0]*i+a[2]*s,a[1]*i+a[3]*s,a[0]*o+a[2]*u+a[4],a[1]*o+a[3]*u+a[5]];e._originalTransform(n,r,i,s,o,u)};e.setTransform=function(n,r,i,s,o,u){this._transformMatrix=[n,r,i,s,o,u];e._originalSetTransform(n,r,i,s,o,u)};e.rotate=function(t){var n=Math.cos(t);var r=Math.sin(t);var i=this._transformMatrix;this._transformMatrix=[i[0]*n+i[2]*r,i[1]*n+i[3]*r,i[0]*-r+i[2]*n,i[1]*-r+i[3]*n,i[4],i[5]];this._originalRotate(t)}}}function compileType3Glyph(e){var t=1e3;var n=e.width,r=e.height;var i,s,o,u=n+1;var a=new Uint8Array(u*(r+1));var f=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]);var l=n+7&~7,c=e.data;var h=new Uint8Array(l*r),p=0,d;for(i=0,d=c.length;i<d;i++){var v=128,m=c[i];while(v>0){h[p++]=m&v?0:255;v>>=1}}var g=0;p=0;if(h[p]!==0){a[0]=1;++g}for(s=1;s<n;s++){if(h[p]!==h[p+1]){a[s]=h[p]?2:1;++g}p++}if(h[p]!==0){a[s]=2;++g}for(i=1;i<r;i++){p=i*l;o=i*u;if(h[p-l]!==h[p]){a[o]=h[p]?1:8;++g}var y=(h[p]?4:0)+(h[p-l]?8:0);for(s=1;s<n;s++){y=(y>>2)+(h[p+1]?4:0)+(h[p-l+1]?8:0);if(f[y]){a[o+s]=f[y];++g}p++}if(h[p-l]!==h[p]){a[o+s]=h[p]?2:4;++g}if(g>t){return null}}p=l*(r-1);o=i*u;if(h[p]!==0){a[o]=8;++g}for(s=1;s<n;s++){if(h[p]!==h[p+1]){a[o+s]=h[p]?4:8;++g}p++}if(h[p]!==0){a[o+s]=4;++g}if(g>t){return null}var b=new Int32Array([0,u,-1,0,-u,0,0,0,1]);var w=[];for(i=0;g&&i<=r;i++){var E=i*u;var S=E+n;while(E<S&&!a[E]){E++}if(E===S){continue}var x=[E%u,i];var T=a[E],N=E,C;do{var k=b[T];do{E+=k}while(!a[E]);C=a[E];if(C!==5&&C!==10){T=C;a[E]=0}else{T=C&51*T>>4;a[E]&=T>>2|T<<2}x.push(E%u);x.push(E/u|0);--g}while(N!==E);w.push(x);--i}var L=function(e){e.save();e.scale(1/n,-1/r);e.translate(0,-r);e.beginPath();for(var t=0,i=w.length;t<i;t++){var s=w[t];e.moveTo(s[0],s[1]);for(var o=2,u=s.length;o<u;o+=2){e.lineTo(s[o],s[o+1])}}e.fill();e.beginPath();e.restore()};return L}var MIN_FONT_SIZE=16;var COMPILE_TYPE3_GLYPHS=true;var CachedCanvases=function(){var t={};return{getCanvas:function(n,r,i,s){var o;if(n in t){o=t[n];o.canvas.width=r;o.canvas.height=i;o.context.setTransform(1,0,0,1,0,0)}else{var u=createScratchCanvas(r,i);var a=u.getContext("2d");if(s){addContextCurrentTransform(a)}t[n]=o={canvas:u,context:a}}return o},clear:function(){t={}}}}();var CanvasExtraState=function(){function t(e){this.alphaIsShape=false;this.fontSize=0;this.fontSizeScale=1;this.textMatrix=IDENTITY_MATRIX;this.fontMatrix=FONT_IDENTITY_MATRIX;this.leading=0;this.x=0;this.y=0;this.lineX=0;this.lineY=0;this.charSpacing=0;this.wordSpacing=0;this.textHScale=1;this.textRenderingMode=TextRenderingMode.FILL;this.textRise=0;this.fillColorSpace=ColorSpace.singletons.gray;this.fillColorSpaceObj=null;this.strokeColorSpace=ColorSpace.singletons.gray;this.strokeColorSpaceObj=null;this.fillColorObj=null;this.strokeColorObj=null;this.fillColor="#000000";this.strokeColor="#000000";this.fillAlpha=1;this.strokeAlpha=1;this.lineWidth=1;this.activeSMask=null;this.old=e}t.prototype={clone:function(){return Object.create(this)},setCurrentPoint:function(t,n){this.x=t;this.y=n}};return t}();var CanvasGraphics=function(){function n(e,t,n,r,i){this.ctx=e;this.current=new CanvasExtraState;this.stateStack=[];this.pendingClip=null;this.pendingEOFill=false;this.res=null;this.xobjs=null;this.commonObjs=t;this.objs=n;this.textLayer=r;this.imageLayer=i;this.groupStack=[];this.processingType3=null;this.baseTransform=null;this.baseTransformStack=[];this.groupLevel=0;this.smaskStack=[];this.smaskCounter=0;this.tempSMask=null;if(e){addContextCurrentTransform(e)}}function r(e,t){if(typeof ImageData!=="undefined"&&t instanceof ImageData){e.putImageData(t,0,0);return}var n=t.height,r=t.width;var i=16;var s=n/i;var o=Math.floor(s);var u=Math.ceil(s);var a=n-o*i;var f=e.createImageData(r,i);var l=0;var c=t.data;var h=f.data;if(t.kind===ImageKind.GRAYSCALE_1BPP){var p=h.length;var d=c.byteLength;var v=PDFJS.hasCanvasTypedArrays?new Uint32Array(h.buffer):new Uint32ArrayView(h);var m=v.length;var g=r+7>>3;var y=4294967295;var b=PDFJS.isLittleEndian||!PDFJS.hasCanvasTypedArrays?4278190080:255;for(var w=0;w<u;w++){var E=w<o?i:a;var S=0;for(var x=0;x<E;x++){var T=d-l;var N=0;var C=T>g?r:T*8-7;var k=C&~7;var L=0;var A=0;for(;N<k;N+=8){A=c[l++];v[S++]=A&128?y:b;v[S++]=A&64?y:b;v[S++]=A&32?y:b;v[S++]=A&16?y:b;v[S++]=A&8?y:b;v[S++]=A&4?y:b;v[S++]=A&2?y:b;v[S++]=A&1?y:b}for(;N<C;N++){if(L===0){A=c[l++];L=128}v[S++]=A&L?y:b;L>>=1}}while(S<m){v[S++]=0}e.putImageData(f,0,w*i)}}else if(t.kind===ImageKind.RGBA_32BPP){for(var w=0;w<u;w++){var E=w<o?i:a;var O=t.width*E*4;h.set(c.subarray(l,l+O));l+=O;e.putImageData(f,0,w*i)}}else if(t.kind===ImageKind.RGB_24BPP){for(var w=0;w<u;w++){var E=w<o?i:a;var O=t.width*E*3;var S=0;for(var x=0;x<O;x+=3){h[S++]=c[l++];h[S++]=c[l++];h[S++]=c[l++];h[S++]=255}e.putImageData(f,0,w*i)}}else{error("bad image kind: "+t.kind)}}function i(e,t){var n=t.height,r=t.width;var i=16;var s=n/i;var o=Math.floor(s);var u=Math.ceil(s);var a=n-o*i;var f=e.createImageData(r,i);var l=0;var c=t.data;var h=f.data;for(var p=0;p<u;p++){var d=p<o?i:a;var v=3;for(var m=0;m<d;m++){var g=0;for(var y=0;y<r;y++){if(!g){var b=c[l++];g=128}h[v]=b&g?0:255;v+=4;g>>=1}}e.putImageData(f,0,p*i)}}function s(e,t){var n=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font"];for(var r=0,i=n.length;r<i;r++){var s=n[r];if(s in e){t[s]=e[s]}}if("setLineDash"in e){t.setLineDash(e.getLineDash());t.lineDashOffset=e.lineDashOffset}else if("mozDash"in e){t.mozDash=e.mozDash;t.mozDashOffset=e.mozDashOffset}}function o(e,t,n){var r=t.canvas;var i=t.context;var s=r.width,o=r.height;var u;if(t.backdrop){var a=t.colorSpace||ColorSpace.singletons.rgb;var f=a.getRgb(t.backdrop,0);u=function(e,t,n,r){var i=r.length;for(var s=3;s<i;s+=4){var o=r[s]/255;if(o===0){r[s-3]=e;r[s-2]=t;r[s-1]=n}else if(o<1){var u=1-o;r[s-3]=r[s-3]*o+e*u|0;r[s-2]=r[s-2]*o+t*u|0;r[s-1]=r[s-1]*o+n*u|0}}}.bind(null,f[0],f[1],f[2])}else{u=function(){}}var l;if(t.subtype==="Luminosity"){l=function(e,t){var n=e.length;for(var r=3;r<n;r+=4){var i=e[r-3]*77+e[r-2]*152+e[r-1]*28|0;t[r]=t[r]*i>>16}}}else{l=function(e,t){var n=e.length;for(var r=3;r<n;r+=4){var i=e[r];t[r]=t[r]*i/255|0}}}var c=16;for(var h=0;h<o;h+=c){var p=Math.min(c,o-h);var d=i.getImageData(0,h,s,p);var v=n.getImageData(0,h,s,p);u(d.data);l(d.data,v.data);i.putImageData(v,0,h)}e.setTransform(1,0,0,1,0,0);e.drawImage(r,t.offsetX,t.offsetY)}var t=15;var u=["butt","round","square"];var a=["miter","round","bevel"];var f={};var l={};n.prototype={beginDrawing:function(t,n){var r=this.ctx.canvas.width;var i=this.ctx.canvas.height;if(n){this.ctx.clearRect(0,0,r,i)}else{this.ctx.mozOpaque=true;this.ctx.save();this.ctx.fillStyle="rgb(255, 255, 255)";this.ctx.fillRect(0,0,r,i);this.ctx.restore()}var s=t.transform;this.ctx.save();this.ctx.transform.apply(this.ctx,s);this.baseTransform=this.ctx.mozCurrentTransform.slice();if(this.textLayer){this.textLayer.beginLayout()}if(this.imageLayer){this.imageLayer.beginLayout()}},executeOperatorList:function(n,r,i,s){var o=n.argsArray;var u=n.fnArray;var a=r||0;var f=o.length;if(f==a){return a}var l;var c=Date.now()+t;var h=this.commonObjs;var p=this.objs;var d;var v=Promise.resolve();while(true){if(s&&a===s.nextBreakPoint){s.breakIt(a,i);return a}d=u[a];if(d!==OPS.dependency){this[d].apply(this,o[a])}else{var m=o[a];for(var g=0,y=m.length;g<y;g++){var b=m[g];var w=b.substring(0,2)=="g_";if(!w&&!p.isResolved(b)){p.get(b,i);return a}if(w&&!h.isResolved(b)){h.get(b,i);return a}}}a++;if(a==f){return a}if(i&&Date.now()>c){v.then(i);return a}}},endDrawing:function(){this.ctx.restore();CachedCanvases.clear();if(this.textLayer){this.textLayer.endLayout()}if(this.imageLayer){this.imageLayer.endLayout()}},setLineWidth:function(t){this.current.lineWidth=t;this.ctx.lineWidth=t},setLineCap:function(t){this.ctx.lineCap=u[t]},setLineJoin:function(t){this.ctx.lineJoin=a[t]},setMiterLimit:function(t){this.ctx.miterLimit=t},setDash:function(t,n){var r=this.ctx;if("setLineDash"in r){r.setLineDash(t);r.lineDashOffset=n}else{r.mozDash=t;r.mozDashOffset=n}},setRenderingIntent:function(t){},setFlatness:function(t){},setGState:function(t){for(var n=0,r=t.length;n<r;n++){var i=t[n];var s=i[0];var o=i[1];switch(s){case"LW":this.setLineWidth(o);break;case"LC":this.setLineCap(o);break;case"LJ":this.setLineJoin(o);break;case"ML":this.setMiterLimit(o);break;case"D":this.setDash(o[0],o[1]);break;case"RI":this.setRenderingIntent(o);break;case"FL":this.setFlatness(o);break;case"Font":this.setFont(o[0],o[1]);break;case"CA":this.current.strokeAlpha=i[1];break;case"ca":this.current.fillAlpha=i[1];this.ctx.globalAlpha=i[1];break;case"BM":if(o&&o.name&&o.name!=="Normal"){var u=o.name.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}).substring(1);this.ctx.globalCompositeOperation=u;if(this.ctx.globalCompositeOperation!==u){warn('globalCompositeOperation "'+u+'" is not supported')}}else{this.ctx.globalCompositeOperation="source-over"}break;case"SMask":if(this.current.activeSMask){this.endSMaskGroup()}this.current.activeSMask=o?this.tempSMask:null;if(this.current.activeSMask){this.beginSMaskGroup()}this.tempSMask=null;break}}},beginSMaskGroup:function(){var t=this.current.activeSMask;var n=t.canvas.width;var r=t.canvas.height;var i="smaskGroupAt"+this.groupLevel;var o=CachedCanvases.getCanvas(i,n,r,true);var u=this.ctx;var a=u.mozCurrentTransform;this.ctx.save();var f=o.context;f.translate(-t.offsetX,-t.offsetY);f.transform.apply(f,a);s(u,f);this.ctx=f;this.setGState([["BM","Normal"],["ca",1],["CA",1]]);this.groupStack.push(u);this.groupLevel++},endSMaskGroup:function(){var t=this.ctx;this.groupLevel--;this.ctx=this.groupStack.pop();o(this.ctx,this.current.activeSMask,t);this.ctx.restore()},save:function(){this.ctx.save();var t=this.current;this.stateStack.push(t);this.current=t.clone();if(this.current.activeSMask){this.current.activeSMask=null}},restore:function(){var t=this.stateStack.pop();if(t){if(this.current.activeSMask){this.endSMaskGroup()}this.current=t;this.ctx.restore()}},transform:function(t,n,r,i,s,o){this.ctx.transform(t,n,r,i,s,o)},moveTo:function(t,n){this.ctx.moveTo(t,n);this.current.setCurrentPoint(t,n)},lineTo:function(t,n){this.ctx.lineTo(t,n);this.current.setCurrentPoint(t,n)},curveTo:function(t,n,r,i,s,o){this.ctx.bezierCurveTo(t,n,r,i,s,o);this.current.setCurrentPoint(s,o)},curveTo2:function(t,n,r,i){var s=this.current;this.ctx.bezierCurveTo(s.x,s.y,t,n,r,i);s.setCurrentPoint(r,i)},curveTo3:function(t,n,r,i){this.curveTo(t,n,r,i,r,i);this.current.setCurrentPoint(r,i)},closePath:function(){this.ctx.closePath()},rectangle:function(t,n,r,i){if(r===0){r=this.getSinglePixelWidth()}if(i===0){i=this.getSinglePixelWidth()}this.ctx.rect(t,n,r,i)},stroke:function(t){t=typeof t!=="undefined"?t:true;var n=this.ctx;var r=this.current.strokeColor;if(this.current.lineWidth===0){n.lineWidth=this.getSinglePixelWidth()}n.globalAlpha=this.current.strokeAlpha;if(r&&r.hasOwnProperty("type")&&r.type==="Pattern"){n.save();n.strokeStyle=r.getPattern(n,this);n.stroke();n.restore()}else{n.stroke()}if(t){this.consumePath()}n.globalAlpha=this.current.fillAlpha},closeStroke:function(){this.closePath();this.stroke()},fill:function(t){t=typeof t!=="undefined"?t:true;var n=this.ctx;var r=this.current.fillColor;var i=false;if(r&&r.hasOwnProperty("type")&&r.type==="Pattern"){n.save();n.fillStyle=r.getPattern(n,this);i=true}if(this.pendingEOFill){if("mozFillRule"in this.ctx){this.ctx.mozFillRule="evenodd";this.ctx.fill();this.ctx.mozFillRule="nonzero"}else{try{this.ctx.fill("evenodd")}catch(s){this.ctx.fill()}}this.pendingEOFill=false}else{this.ctx.fill()}if(i){n.restore()}if(t){this.consumePath()}},eoFill:function(){this.pendingEOFill=true;this.fill()},fillStroke:function(){this.fill(false);this.stroke(false);this.consumePath()},eoFillStroke:function(){this.pendingEOFill=true;this.fillStroke()},closeFillStroke:function(){this.closePath();this.fillStroke()},closeEOFillStroke:function(){this.pendingEOFill=true;this.closePath();this.fillStroke()},endPath:function(){this.consumePath()},clip:function(){this.pendingClip=f},eoClip:function(){this.pendingClip=l},beginText:function(){this.current.textMatrix=IDENTITY_MATRIX;this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0},endText:function(){if(!("pendingTextPaths"in this)){this.ctx.beginPath();return}var t=this.pendingTextPaths;var n=this.ctx;n.save();n.beginPath();for(var r=0;r<t.length;r++){var i=t[r];n.setTransform.apply(n,i.transform);n.translate(i.x,i.y);i.addToPath(n,i.fontSize)}n.restore();n.clip();n.beginPath();delete this.pendingTextPaths},setCharSpacing:function(t){this.current.charSpacing=t},setWordSpacing:function(t){this.current.wordSpacing=t},setHScale:function(t){this.current.textHScale=t/100},setLeading:function(t){this.current.leading=-t},setFont:function(t,n){var r=this.commonObjs.get(t);var i=this.current;if(!r){error("Can't find font for "+t)}i.fontMatrix=r.fontMatrix?r.fontMatrix:FONT_IDENTITY_MATRIX;if(i.fontMatrix[0]===0||i.fontMatrix[3]===0){warn("Invalid font matrix for font "+t)}if(n<0){n=-n;i.fontDirection=-1}else{i.fontDirection=1}this.current.font=r;this.current.fontSize=n;if(r.coded){return}var s=r.loadedName||"sans-serif";var o=r.black?r.bold?"bolder":"bold":r.bold?"bold":"normal";var u=r.italic?"italic":"normal";var a='"'+s+'", '+r.fallbackName;var f=n>=MIN_FONT_SIZE?n:MIN_FONT_SIZE;this.current.fontSizeScale=f!=MIN_FONT_SIZE?1:n/MIN_FONT_SIZE;var l=u+" "+o+" "+f+"px "+a;this.ctx.font=l},setTextRenderingMode:function(t){this.current.textRenderingMode=t},setTextRise:function(t){this.current.textRise=t},moveText:function(t,n){this.current.x=this.current.lineX+=t;this.current.y=this.current.lineY+=n},setLeadingMoveText:function(t,n){this.setLeading(-n);this.moveText(t,n)},setTextMatrix:function(t,n,r,i,s,o){this.current.textMatrix=[t,n,r,i,s,o];this.current.x=this.current.lineX=0;this.current.y=this.current.lineY=0},nextLine:function(){this.moveText(0,this.current.leading)},applyTextTransforms:function(){var t=this.ctx;var n=this.current;t.transform.apply(t,n.textMatrix);t.translate(n.x,n.y+n.textRise);if(n.fontDirection>0){t.scale(n.textHScale,-1)}else{t.scale(-n.textHScale,1)}},createTextGeometry:function(){var t={};var n=this.ctx;var r=this.current.font;var i=n.mozCurrentTransform;var s=i[0],o=i[1],u=i[2];var a=i[3],f=i[4],l=i[5];var c=s>=0?Math.sqrt(s*s+o*o):-Math.sqrt(s*s+o*o);var h=a>=0?Math.sqrt(u*u+a*a):-Math.sqrt(u*u+a*a);var p=Math.atan2(o,s);var d=f;var v=l;t.x=d;t.y=v;t.hScale=c;t.vScale=h;t.angle=p;t.spaceWidth=r.spaceWidth;t.fontName=r.loadedName;t.fontFamily=r.fallbackName;t.fontSize=this.current.fontSize;t.ascent=r.ascent;t.descent=r.descent;return t},paintChar:function(e,t,n){var r=this.ctx;var i=this.current;var s=i.font;var o=i.fontSize/i.fontSizeScale;var u=i.textRenderingMode;var a=u&TextRenderingMode.FILL_STROKE_MASK;var f=!!(u&TextRenderingMode.ADD_TO_PATH_FLAG);var l;if(s.disableFontFace||f){l=s.getPathGenerator(this.commonObjs,e)}if(s.disableFontFace){r.save();r.translate(t,n);r.beginPath();l(r,o);if(a===TextRenderingMode.FILL||a===TextRenderingMode.FILL_STROKE){r.fill()}if(a===TextRenderingMode.STROKE||a===TextRenderingMode.FILL_STROKE){r.stroke()}r.restore()}else{if(a===TextRenderingMode.FILL||a===TextRenderingMode.FILL_STROKE){r.fillText(e,t,n)}if(a===TextRenderingMode.STROKE||a===TextRenderingMode.FILL_STROKE){r.strokeText(e,t,n)}}if(f){var c=this.pendingTextPaths||(this.pendingTextPaths=[]);c.push({transform:r.mozCurrentTransform,x:t,y:n,fontSize:o,addToPath:l})}},get isFontSubpixelAAEnabled(){var e=document.createElement("canvas").getContext("2d");e.scale(1.5,1);e.fillText("I",0,10);var t=e.getImageData(0,0,10,10).data;var n=false;for(var r=3;r<t.length;r+=4){if(t[r]>0&&t[r]<255){n=true;break}}return shadow(this,"isFontSubpixelAAEnabled",n)},showText:function(t,n){var r=this.ctx;var i=this.current;var s=i.font;var o=i.fontSize;var u=i.fontSizeScale;var a=i.charSpacing;var f=i.wordSpacing;var l=i.textHScale*i.fontDirection;var c=i.fontMatrix||FONT_IDENTITY_MATRIX;var h=t.length;var p=this.textLayer;var d;var v=p&&!n?true:false;var m=0;var g=s.vertical;var y=s.defaultVMetrics;if(s.coded){r.save();r.transform.apply(r,i.textMatrix);r.translate(i.x,i.y);r.scale(l,1);if(v){this.save();r.scale(1,-1);d=this.createTextGeometry();this.restore()}for(var b=0;b<h;++b){var w=t[b];if(w===null){this.ctx.translate(f,0);i.x+=f*l;continue}this.processingType3=w;this.save();r.scale(o,o);r.transform.apply(r,c);this.executeOperatorList(w.operatorList);this.restore();var E=Util.applyTransform([w.width,0],c);var S=(E[0]*o+a)*i.fontDirection;r.translate(S,0);i.x+=S*l;m+=S}r.restore();this.processingType3=null}else{r.save();this.applyTextTransforms();var x=i.lineWidth;var T=i.textMatrix[0],N=i.textMatrix[1];var C=Math.sqrt(T*T+N*N);if(C===0||x===0){x=this.getSinglePixelWidth()}else{x/=C}if(v){d=this.createTextGeometry()}if(u!=1){r.scale(u,u);x/=u}r.lineWidth=x;var k=0;for(var b=0;b<h;++b){var w=t[b];if(w===null){k+=i.fontDirection*f;continue}var L=false;var A=w.fontChar;var O=w.vmetric||y;if(g){var M=w.vmetric?O[1]:w.width*.5;M=-M*o*i.fontMatrix[0];var _=O[2]*o*i.fontMatrix[0]}var S=O?-O[0]:w.width;var D=S*o*i.fontMatrix[0]+a*i.fontDirection;var P=w.accent;var H,B,j,F;if(g){H=M/u;B=(k+_)/u}else{H=k/u;B=0}if(s.remeasure&&S>0&&this.isFontSubpixelAAEnabled){var I=r.measureText(A).width*1e3/i.fontSize*i.fontSizeScale;var q=S/I;L=true;r.save();r.scale(q,1);H/=q;if(P){j/=q}}this.paintChar(A,H,B);if(P){j=H+P.offset.x/u;F=B-P.offset.y/u;this.paintChar(P.fontChar,j,F)}k+=D;m+=D;if(L){r.restore()}}if(g){i.y-=k*l}else{i.x+=k*l}r.restore()}if(v){d.canvasWidth=m;if(g){var R=Math.PI/2;d.angle+=R}this.textLayer.appendText(d)}return m},showSpacedText:function(t){var n=this.ctx;var r=this.current;var i=r.font;var s=r.fontSize;var o=r.textHScale*.001*r.fontDirection;var u=t.length;var a=this.textLayer;var f;var l=0;var c=a?true:false;var h=i.vertical;var p=0;if(c){n.save();this.applyTextTransforms();f=this.createTextGeometry();n.restore()}for(var d=0;d<u;++d){var v=t[d];if(isNum(v)){var m=-v*s*o;if(h){r.y+=m}else{r.x+=m}if(c){p+=m}}else{var g=this.showText(v,true);if(c){l+=p+g;p=0}}}if(c){f.canvasWidth=l;if(h){var y=Math.PI/2;f.angle+=y}this.textLayer.appendText(f)}},nextLineShowText:function(t){this.nextLine();this.showText(t)},nextLineSetSpacingShowText:function(t,n,r){this.setWordSpacing(t);this.setCharSpacing(n);this.nextLineShowText(r)},setCharWidth:function(t,n){},setCharWidthAndBounds:function(t,n,r,i,s,o){this.rectangle(r,i,s-r,o-i);this.clip();this.endPath()},setStrokeColorSpace:function(t){this.current.strokeColorSpace=ColorSpace.fromIR(t)},setFillColorSpace:function(t){this.current.fillColorSpace=ColorSpace.fromIR(t)},setStrokeColor:function(){var t=this.current.strokeColorSpace;var n=t.getRgb(arguments,0);var r=Util.makeCssRgb(n);this.ctx.strokeStyle=r;this.current.strokeColor=r},getColorN_Pattern:function(t,n){if(t[0]=="TilingPattern"){var r=t[1];var i=n.base;var s;if(i){var o=i.numComps;s=i.getRgb(r,0)}var u=new TilingPattern(t,s,this.ctx,this.objs,this.commonObjs,this.baseTransform)}else{var u=getShadingPatternFromIR(t)}return u},setStrokeColorN:function(){var t=this.current.strokeColorSpace;if(t.name=="Pattern"){this.current.strokeColor=this.getColorN_Pattern(arguments,t)}else{this.setStrokeColor.apply(this,arguments)}},setFillColor:function(){var t=this.current.fillColorSpace;var n=t.getRgb(arguments,0);var r=Util.makeCssRgb(n);this.ctx.fillStyle=r;this.current.fillColor=r},setFillColorN:function(){var t=this.current.fillColorSpace;if(t.name=="Pattern"){this.current.fillColor=this.getColorN_Pattern(arguments,t)}else{this.setFillColor.apply(this,arguments)}},setStrokeGray:function(t){this.current.strokeColorSpace=ColorSpace.singletons.gray;var n=this.current.strokeColorSpace.getRgb(arguments,0);var r=Util.makeCssRgb(n);this.ctx.strokeStyle=r;this.current.strokeColor=r},setFillGray:function(t){this.current.fillColorSpace=ColorSpace.singletons.gray;var n=this.current.fillColorSpace.getRgb(arguments,0);var r=Util.makeCssRgb(n);this.ctx.fillStyle=r;this.current.fillColor=r},setStrokeRGBColor:function(t,n,r){this.current.strokeColorSpace=ColorSpace.singletons.rgb;var i=this.current.strokeColorSpace.getRgb(arguments,0);var s=Util.makeCssRgb(i);this.ctx.strokeStyle=s;this.current.strokeColor=s},setFillRGBColor:function(t,n,r){this.current.fillColorSpace=ColorSpace.singletons.rgb;var i=this.current.fillColorSpace.getRgb(arguments,0);var s=Util.makeCssRgb(i);this.ctx.fillStyle=s;this.current.fillColor=s},setStrokeCMYKColor:function(t,n,r,i){this.current.strokeColorSpace=ColorSpace.singletons.cmyk;var s=Util.makeCssCmyk(arguments);this.ctx.strokeStyle=s;this.current.strokeColor=s},setFillCMYKColor:function(t,n,r,i){this.current.fillColorSpace=ColorSpace.singletons.cmyk;var s=Util.makeCssCmyk(arguments);this.ctx.fillStyle=s;this.current.fillColor=s},shadingFill:function(t){var n=this.ctx;this.save();var r=getShadingPatternFromIR(t);n.fillStyle=r.getPattern(n,this,true);var i=n.mozCurrentTransformInverse;if(i){var s=n.canvas;var o=s.width;var u=s.height;var a=Util.applyTransform([0,0],i);var f=Util.applyTransform([0,u],i);var l=Util.applyTransform([o,0],i);var c=Util.applyTransform([o,u],i);var h=Math.min(a[0],f[0],l[0],c[0]);var p=Math.min(a[1],f[1],l[1],c[1]);var d=Math.max(a[0],f[0],l[0],c[0]);var v=Math.max(a[1],f[1],l[1],c[1]);this.ctx.fillRect(h,p,d-h,v-p)}else{this.ctx.fillRect(-1e10,-1e10,2e10,2e10)}this.restore()},beginInlineImage:function(){error("Should not call beginInlineImage")},beginImageData:function(){error("Should not call beginImageData")},paintFormXObjectBegin:function(t,n){this.save();this.baseTransformStack.push(this.baseTransform);if(t&&isArray(t)&&6==t.length){this.transform.apply(this,t)}this.baseTransform=this.ctx.mozCurrentTransform;if(n&&isArray(n)&&4==n.length){var r=n[2]-n[0];var i=n[3]-n[1];this.rectangle(n[0],n[1],r,i);this.clip();this.endPath()}},paintFormXObjectEnd:function(){this.restore();this.baseTransform=this.baseTransformStack.pop()},beginGroup:function(t){this.save();var n=this.ctx;if(!t.isolated){info("TODO: Support non-isolated groups.")}if(t.knockout){warn("Knockout groups not supported.")}var r=n.mozCurrentTransform;if(t.matrix){n.transform.apply(n,t.matrix)}assert(t.bbox,"Bounding box is required.");var i=Util.getAxialAlignedBoundingBox(t.bbox,n.mozCurrentTransform);var o=[0,0,n.canvas.width,n.canvas.height];i=Util.intersect(i,o)||[0,0,0,0];var u=Math.max(Math.ceil(i[2]-i[0]),1);var a=Math.max(Math.ceil(i[3]-i[1]),1);var f="groupAt"+this.groupLevel;if(t.smask){f+="_smask_"+this.smaskCounter++%2}var l=CachedCanvases.getCanvas(f,u,a,true);var c=l.context;var h=i[0];var p=i[1];c.translate(-h,-p);c.transform.apply(c,r);if(t.smask){this.smaskStack.push({canvas:l.canvas,context:c,offsetX:h,offsetY:p,subtype:t.smask.subtype,backdrop:t.smask.backdrop,colorSpace:t.colorSpace&&ColorSpace.fromIR(t.colorSpace)})}else{n.setTransform(1,0,0,1,0,0);n.translate(h,p)}s(n,c);this.ctx=c;this.setGState([["BM","Normal"],["ca",1],["CA",1]]);this.groupStack.push(n);this.groupLevel++},endGroup:function(t){this.groupLevel--;var n=this.ctx;this.ctx=this.groupStack.pop();if("imageSmoothingEnabled"in this.ctx){this.ctx.imageSmoothingEnabled=false}else{this.ctx.mozImageSmoothingEnabled=false}if(t.smask){this.tempSMask=this.smaskStack.pop()}else{this.ctx.drawImage(n.canvas,0,0)}this.restore()},beginAnnotations:function(){this.save();this.current=new CanvasExtraState},endAnnotations:function(){this.restore()},beginAnnotation:function(t,n,r){this.save();if(t&&isArray(t)&&4==t.length){var i=t[2]-t[0];var s=t[3]-t[1];this.rectangle(t[0],t[1],i,s);this.clip();this.endPath()}this.transform.apply(this,n);this.transform.apply(this,r)},endAnnotation:function(){this.restore()},paintJpegXObject:function(t,n,r){var i=this.objs.get(t);if(!i){error("Dependent image isn't ready yet")}this.save();var s=this.ctx;s.scale(1/n,-1/r);s.drawImage(i,0,0,i.width,i.height,0,-r,n,r);if(this.imageLayer){var o=s.mozCurrentTransformInverse;var u=this.getCanvasPosition(0,0);this.imageLayer.appendImage({objId:t,left:u[0],top:u[1],width:n/o[0],height:r/o[3]})}this.restore()},paintImageMaskXObject:function(t){var n=this.ctx;var r=t.width,s=t.height;var o=this.processingType3;if(COMPILE_TYPE3_GLYPHS&&o&&!("compiled"in o)){var u=1e3;if(r<=u&&s<=u){o.compiled=compileType3Glyph({data:t.data,width:r,height:s})}else{o.compiled=null}}if(o&&o.compiled){o.compiled(n);return}var a=CachedCanvases.getCanvas("maskCanvas",r,s);var f=a.context;f.save();i(f,t);f.globalCompositeOperation="source-in";var l=this.current.fillColor;f.fillStyle=l&&l.hasOwnProperty("type")&&l.type==="Pattern"?l.getPattern(f,this):l;f.fillRect(0,0,r,s);f.restore();this.paintInlineImageXObject(a.canvas)},paintImageMaskXObjectRepeat:function(t,n,r,s){var o=t.width;var u=t.height;var a=this.ctx;var f=CachedCanvases.getCanvas("maskCanvas",o,u);var l=f.context;l.save();i(l,t);l.globalCompositeOperation="source-in";var c=this.current.fillColor;l.fillStyle=c&&c.hasOwnProperty("type")&&c.type==="Pattern"?c.getPattern(l,this):c;l.fillRect(0,0,o,u);l.restore();for(var h=0,p=s.length;h<p;h+=2){a.save();a.transform(n,0,0,r,s[h],s[h+1]);a.scale(1,-1);a.drawImage(f.canvas,0,0,o,u,0,-1,1,1);a.restore()}},paintImageMaskXObjectGroup:function(t){var n=this.ctx;for(var r=0,s=t.length;r<s;r++){var o=t[r];var u=o.width,a=o.height;var f=CachedCanvases.getCanvas("maskCanvas",u,a);var l=f.context;l.save();i(l,o);l.globalCompositeOperation="source-in";var c=this.current.fillColor;l.fillStyle=c&&c.hasOwnProperty("type")&&c.type==="Pattern"?c.getPattern(l,this):c;l.fillRect(0,0,u,a);l.restore();n.save();n.transform.apply(n,o.transform);n.scale(1,-1);n.drawImage(f.canvas,0,0,u,a,0,-1,1,1);n.restore()}},paintImageXObject:function(t){var n=this.objs.get(t);if(!n){error("Dependent image isn't ready yet")}this.paintInlineImageXObject(n)},paintImageXObjectRepeat:function(t,n,r,i){var s=this.objs.get(t);if(!s){error("Dependent image isn't ready yet")}var o=s.width;var u=s.height;var a=[];for(var f=0,l=i.length;f<l;f+=2){a.push({transform:[n,0,0,r,i[f],i[f+1]],x:0,y:0,w:o,h:u})}this.paintInlineImageXObjectGroup(s,a)},paintInlineImageXObject:function(t){var n=t.width;var i=t.height;var s=this.ctx;this.save();s.scale(1/n,-1/i);var o=s.mozCurrentTransformInverse;var u=o[0],a=o[1];var f=Math.max(Math.sqrt(u*u+a*a),1);var l=o[2],c=o[3];var h=Math.max(Math.sqrt(l*l+c*c),1);var p;if(t instanceof HTMLElement||!t.data){p=t}else{var d=CachedCanvases.getCanvas("inlineImage",n,i);var v=d.context;r(v,t);p=d.canvas}var m=n,g=i;var y="prescale1";while(f>2&&m>1||h>2&&g>1){var b=m,w=g;if(f>2&&m>1){b=Math.ceil(m/2);f/=m/b}if(h>2&&g>1){w=Math.ceil(g/2);h/=g/w}var d=CachedCanvases.getCanvas(y,b,w);v=d.context;v.clearRect(0,0,b,w);v.drawImage(p,0,0,m,g,0,0,b,w);p=d.canvas;m=b;g=w;y=y==="prescale1"?"prescale2":"prescale1"}s.drawImage(p,0,0,m,g,0,-i,n,i);if(this.imageLayer){var E=this.getCanvasPosition(0,-i);this.imageLayer.appendImage({imgData:t,left:E[0],top:E[1],width:n/o[0],height:i/o[3]})}this.restore()},paintInlineImageXObjectGroup:function(t,n){var i=this.ctx;var s=t.width;var o=t.height;var u=CachedCanvases.getCanvas("inlineImage",s,o);var a=u.context;r(a,t);for(var f=0,l=n.length;f<l;f++){var c=n[f];i.save();i.transform.apply(i,c.transform);i.scale(1,-1);i.drawImage(u.canvas,c.x,c.y,c.w,c.h,0,-1,1,1);if(this.imageLayer){var h=this.getCanvasPosition(c.x,c.y);this.imageLayer.appendImage({imgData:t,left:h[0],top:h[1],width:s,height:o})}i.restore()}},paintSolidColorImageMask:function(){this.ctx.fillRect(0,0,1,1)},markPoint:function(t){},markPointProps:function(t,n){},beginMarkedContent:function(t){},beginMarkedContentProps:function(t,n){},endMarkedContent:function(){},beginCompat:function(){},endCompat:function(){},consumePath:function(){if(this.pendingClip){if(this.pendingClip==l){if("mozFillRule"in this.ctx){this.ctx.mozFillRule="evenodd";this.ctx.clip();this.ctx.mozFillRule="nonzero"}else{try{this.ctx.clip("evenodd")}catch(t){this.ctx.clip()}}}else{this.ctx.clip()}this.pendingClip=null}this.ctx.beginPath()},getSinglePixelWidth:function(t){var n=this.ctx.mozCurrentTransformInverse;return Math.sqrt(Math.max(n[0]*n[0]+n[1]*n[1],n[2]*n[2]+n[3]*n[3]))},getCanvasPosition:function(t,n){var r=this.ctx.mozCurrentTransform;return[r[0]*t+r[2]*n+r[4],r[1]*t+r[3]*n+r[5]]}};for(var c in OPS){n.prototype[OPS[c]]=n.prototype[c]}return n}()