"use strict";var PDFFunction=function(){var t=0;var n=2;var r=3;var i=4;return{getSampleArray:function(t,n,r,i){var s=1;for(var o=0,u=t.length;o<u;o++){s*=t[o]}s*=n;var a=[];var f=0;var l=0;var c=1/(Math.pow(2,r)-1);var h=i.getBytes((s*r+7)/8);var p=0;for(var o=0;o<s;o++){while(f<r){l<<=8;l|=h[p++];f+=8}f-=r;a.push((l>>f)*c);l&=(1<<f)-1}return a},getIR:function(t,n){var r=n.dict;if(!r){r=n}var i=[this.constructSampled,null,this.constructInterpolated,this.constructStiched,this.constructPostScript];var s=r.get("FunctionType");var o=i[s];if(!o){error("Unknown type of function")}return o.call(this,n,r,t)},fromIR:function(i){var s=i[0];switch(s){case t:return this.constructSampledFromIR(i);case n:return this.constructInterpolatedFromIR(i);case r:return this.constructStichedFromIR(i);default:return this.constructPostScriptFromIR(i)}},parse:function(t,n){var r=this.getIR(t,n);return this.fromIR(r)},constructSampled:function(n,r){function i(e){var t=e.length;var n=e.length/2;var r=[];var i=0;for(var s=0;s<t;s+=2){r[i]=[e[s],e[s+1]];++i}return r}var s=r.get("Domain");var o=r.get("Range");if(!s||!o){error("No domain or range")}var u=s.length/2;var a=o.length/2;s=i(s);o=i(o);var f=r.get("Size");var l=r.get("BitsPerSample");var c=r.get("Order")||1;if(c!==1){info("No support for cubic spline interpolation: "+c)}var h=r.get("Encode");if(!h){h=[];for(var p=0;p<u;++p){h.push(0);h.push(f[p]-1)}}h=i(h);var d=r.get("Decode");if(!d){d=o}else{d=i(d)}var v=this.getSampleArray(f,a,l,n);return[t,u,s,h,d,v,f,a,Math.pow(2,l)-1,o]},constructSampledFromIR:function(t){function n(e,t,n,r,i){return r+(e-t)*((i-r)/(n-t))}return function(r){var i=t[1];var s=t[2];var o=t[3];var u=t[4];var a=t[5];var f=t[6];var l=t[7];var c=t[8];var h=t[9];if(i!=r.length){error("Incorrect number of arguments: "+i+" != "+r.length)}var p=r;var d=1<<i;var v=new Float64Array(d);var m=new Uint32Array(d);for(var g=0;g<d;g++){v[g]=1}var y=l,b=1;for(var w=0;w<i;++w){var E=s[w][0];var S=s[w][1];var x=Math.min(Math.max(p[w],E),S);var T=n(x,E,S,o[w][0],o[w][1]);var N=f[w];T=Math.min(Math.max(T,0),N-1);var C=T<N-1?Math.floor(T):T-1;var k=C+1-T;var L=T-C;var A=C*y;var O=A+y;for(var g=0;g<d;g++){if(g&b){v[g]*=L;m[g]+=O}else{v[g]*=k;m[g]+=A}}y*=N;b<<=1}var M=new Float64Array(l);for(var g=0;g<l;++g){var _=0;for(var w=0;w<d;w++){_+=a[m[w]+g]*v[w]}_=n(_,0,1,u[g][0],u[g][1]);M[g]=Math.min(Math.max(_,h[g][0]),h[g][1])}return M}},constructInterpolated:function(t,r){var i=r.get("C0")||[0];var s=r.get("C1")||[1];var o=r.get("N");if(!isArray(i)||!isArray(s)){error("Illegal dictionary for interpolated function")}var u=i.length;var a=[];for(var f=0;f<u;++f){a.push(s[f]-i[f])}return[n,i,a,o]},constructInterpolatedFromIR:function(t){var n=t[1];var r=t[2];var i=t[3];var s=r.length;return function(t){var o=i==1?t[0]:Math.pow(t[0],i);var u=[];for(var a=0;a<s;++a){u.push(n[a]+o*r[a])}return u}},constructStiched:function(t,n,i){var s=n.get("Domain");if(!s){error("No domain")}var o=s.length/2;if(o!=1){error("Bad domain for stiched function")}var u=n.get("Functions");var a=[];for(var f=0,l=u.length;f<l;++f){a.push(PDFFunction.getIR(i,i.fetchIfRef(u[f])))}var c=n.get("Bounds");var h=n.get("Encode");return[r,s,c,h,a]},constructStichedFromIR:function(t){var n=t[1];var r=t[2];var i=t[3];var s=t[4];var o=[];for(var u=0,a=s.length;u<a;u++){o.push(PDFFunction.fromIR(s[u]))}return function(t){var s=function(t,n,r){if(t>r){t=r}else if(t<n){t=n}return t};var u=s(t[0],n[0],n[1]);for(var a=0,f=r.length;a<f;++a){if(u<r[a]){break}}var l=n[0];if(a>0){l=r[a-1]}var c=n[1];if(a<r.length){c=r[a]}var h=i[2*a];var p=i[2*a+1];var d=h+(u-l)*(p-h)/(c-l);return o[a]([d])}},constructPostScript:function(t,n,r){var s=n.get("Domain");var o=n.get("Range");if(!s){error("No domain.")}if(!o){error("No range.")}var u=new PostScriptLexer(t);var a=new PostScriptParser(u);var f=a.parse();return[i,s,o,f]},constructPostScriptFromIR:function(t){var n=t[1];var r=t[2];var i=t[3];var s=r.length/2;var o=new PostScriptEvaluator(i);var u=new FunctionCache;return function(t){var i=[];for(var a=0,f=n.length/2;a<f;++a){i.push(t[a])}var l=i.join("_");if(u.has(l)){return u.get(l)}var c=o.execute(i);var h=[];for(a=s-1;a>=0;--a){var p=c.pop();var d=2*a;if(p<r[d]){p=r[d]}else if(p>r[d+1]){p=r[d+1]}h[a]=p}u.set(l,h);return h}}}}();var FunctionCache=function(){function n(){this.cache={};this.total=0}var t=1024;n.prototype={has:function(t){return t in this.cache},get:function(t){return this.cache[t]},set:function(n,r){if(this.total<t){this.cache[n]=r;this.total++}}};return n}();var PostScriptStack=function(){function n(e){this.stack=e||[]}var t=100;n.prototype={push:function(n){if(this.stack.length>=t){error("PostScript function stack overflow.")}this.stack.push(n)},pop:function(){if(this.stack.length<=0){error("PostScript function stack underflow.")}return this.stack.pop()},copy:function(n){if(this.stack.length+n>=t){error("PostScript function stack overflow.")}var r=this.stack;for(var i=r.length-n,s=n-1;s>=0;s--,i++){r.push(r[i])}},index:function(t){this.push(this.stack[this.stack.length-t-1])},roll:function(t,n){var r=this.stack;var i=r.length-t;var s=r.length-1,o=i+(n-Math.floor(n/t)*t),u,a,f;for(u=i,a=s;u<a;u++,a--){f=r[u];r[u]=r[a];r[a]=f}for(u=i,a=o-1;u<a;u++,a--){f=r[u];r[u]=r[a];r[a]=f}for(u=o,a=s;u<a;u++,a--){f=r[u];r[u]=r[a];r[a]=f}}};return n}();var PostScriptEvaluator=function(){function t(e){this.operators=e}t.prototype={execute:function(t){var n=new PostScriptStack(t);var r=0;var i=this.operators;var s=i.length;var o,u,a;while(r<s){o=i[r++];if(typeof o=="number"){n.push(o);continue}switch(o){case"jz":a=n.pop();u=n.pop();if(!u){r=a}break;case"j":u=n.pop();r=u;break;case"abs":u=n.pop();n.push(Math.abs(u));break;case"add":a=n.pop();u=n.pop();n.push(u+a);break;case"and":a=n.pop();u=n.pop();if(isBool(u)&&isBool(a)){n.push(u&&a)}else{n.push(u&a)}break;case"atan":u=n.pop();n.push(Math.atan(u));break;case"bitshift":a=n.pop();u=n.pop();if(u>0){n.push(u<<a)}else{n.push(u>>a)}break;case"ceiling":u=n.pop();n.push(Math.ceil(u));break;case"copy":u=n.pop();n.copy(u);break;case"cos":u=n.pop();n.push(Math.cos(u));break;case"cvi":u=n.pop()|0;n.push(u);break;case"cvr":break;case"div":a=n.pop();u=n.pop();n.push(u/a);break;case"dup":n.copy(1);break;case"eq":a=n.pop();u=n.pop();n.push(u==a);break;case"exch":n.roll(2,1);break;case"exp":a=n.pop();u=n.pop();n.push(Math.pow(u,a));break;case"false":n.push(false);break;case"floor":u=n.pop();n.push(Math.floor(u));break;case"ge":a=n.pop();u=n.pop();n.push(u>=a);break;case"gt":a=n.pop();u=n.pop();n.push(u>a);break;case"idiv":a=n.pop();u=n.pop();n.push(u/a|0);break;case"index":u=n.pop();n.index(u);break;case"le":a=n.pop();u=n.pop();n.push(u<=a);break;case"ln":u=n.pop();n.push(Math.log(u));break;case"log":u=n.pop();n.push(Math.log(u)/Math.LN10);break;case"lt":a=n.pop();u=n.pop();n.push(u<a);break;case"mod":a=n.pop();u=n.pop();n.push(u%a);break;case"mul":a=n.pop();u=n.pop();n.push(u*a);break;case"ne":a=n.pop();u=n.pop();n.push(u!=a);break;case"neg":u=n.pop();n.push(-a);break;case"not":u=n.pop();if(isBool(u)&&isBool(a)){n.push(u&&a)}else{n.push(u&a)}break;case"or":a=n.pop();u=n.pop();if(isBool(u)&&isBool(a)){n.push(u||a)}else{n.push(u|a)}break;case"pop":n.pop();break;case"roll":a=n.pop();u=n.pop();n.roll(u,a);break;case"round":u=n.pop();n.push(Math.round(u));break;case"sin":u=n.pop();n.push(Math.sin(u));break;case"sqrt":u=n.pop();n.push(Math.sqrt(u));break;case"sub":a=n.pop();u=n.pop();n.push(u-a);break;case"true":n.push(true);break;case"truncate":u=n.pop();u=u<0?Math.ceil(u):Math.floor(u);n.push(u);break;case"xor":a=n.pop();u=n.pop();if(isBool(u)&&isBool(a)){n.push(u!=a)}else{n.push(u^a)}break;default:error("Unknown operator "+o);break}}return n.stack}};return t}()